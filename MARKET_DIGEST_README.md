# üåç –ö—Ä–∏–ø—Ç–æ-–¥–∞–π–¥–∂–µ—Å—Ç —Ä—ã–Ω–∫–∞

## üìã –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `MarketDigest` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤–æ–¥–∫—É –∫—Ä–∏–ø—Ç–æ—Ä—ã–Ω–∫–∞ —Å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ CoinGecko API (30 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω –Ω–∞ Free tier).

## üìä –î–∞–Ω–Ω—ã–µ

| –ò—Å—Ç–æ—á–Ω–∏–∫ | API | –ö—ç—à | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|-----|----------|
| üî• –¢—Ä–µ–Ω–¥—ã | CoinGecko `/search/trending` | 5 –º–∏–Ω | –¢–æ–ø-7 —Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö –º–æ–Ω–µ—Ç |
| üìä –ì–ª–æ–±–∞–ª—å–Ω—ã–µ | CoinGecko `/global` | 10 –º–∏–Ω | –ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è, BTC.D, ETH.D |
| üò® Fear & Greed | Alternative.me `/fng/` | 60 –º–∏–Ω | –ò–Ω–¥–µ–∫—Å —Å—Ç—Ä–∞—Ö–∞ –∏ –∂–∞–¥–Ω–æ—Å—Ç–∏ |

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥–∞ /digest

```
/digest
```

–í—ã–≤–æ–¥:
```
üåç –ö—Ä–∏–ø—Ç–æ-–¥–∞–π–¥–∂–µ—Å—Ç

üí∞ –ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è: $2.1T (+2.3%)
‚Çø BTC.D: 54.2%  ‚¨° ETH.D: 17.1%
üò® Fear & Greed: 65 (üòä Greed)
üî• –í —Ç—Ä–µ–Ω–¥–µ: SOL, PEPE, DOGE, BONK, WIF, FET, RENDER

üïê –û–±–Ω–æ–≤–ª–µ–Ω–æ: 2–º–∏–Ω –Ω–∞–∑–∞–¥
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from market_digest import MarketDigest
from pathlib import Path

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
market = MarketDigest(Path("market_cache.json"))

# –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ API)
await market.refresh_all()

# –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –¥–∞–π–¥–∂–µ—Å—Ç–∞ (–ë–ï–ó –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API!)
text = market.get_digest()

# –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
metrics = market.get_metrics()
print(f"CoinGecko calls: {metrics['coingecko_calls_last_minute']}/30")
```

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç

### 1. –§–∞–π–ª—ã

```
Infobot/
‚îú‚îÄ‚îÄ market_digest.py      # –ö–ª–∞—Å—Å MarketDigest
‚îú‚îÄ‚îÄ market_cache.json     # –ö—ç—à (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ config.py             # –î–æ–±–∞–≤–ª–µ–Ω MARKET_CACHE_PATH
‚îî‚îÄ‚îÄ bot.py                # –î–æ–±–∞–≤–ª–µ–Ω —Ö–µ–Ω–¥–ª–µ—Ä /digest
```

### 2. config.py

```python
MARKET_CACHE_PATH = PROJECT_ROOT / "market_cache.json"
```

### 3. bot.py ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```python
from market_digest import MarketDigest

class BotApp:
    def __init__(self):
        self.market_digest: Optional[MarketDigest] = None
    
    async def on_startup(self):
        self.market_digest = MarketDigest(MARKET_CACHE_PATH)
        await self.market_digest.refresh_all()
```

### 4. bot.py ‚Äî –•–µ–Ω–¥–ª–µ—Ä

```python
@dp.message(Command("digest"))
async def cmd_digest(message: types.Message):
    text = market_digest.get_digest()  # –ë–ï–ó API –∑–∞–ø—Ä–æ—Å–æ–≤!
    await message.answer(text, parse_mode="HTML")
```

### 5. bot.py ‚Äî –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

```python
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
scheduler.add_job(
    lambda: asyncio.create_task(market_digest.refresh_all()),
    trigger="interval",
    minutes=5
)
```

## ‚ö†Ô∏è –õ–∏–º–∏—Ç—ã API

### CoinGecko (Free tier)
- **30 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω**
- –ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤
- –ü—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –ª–∏–º–∏—Ç—É ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

### Alternative.me (Fear & Greed)
- –ë–µ–∑ —Å—Ç—Ä–æ–≥–∏—Ö –ª–∏–º–∏—Ç–æ–≤
- –ö—ç—à 60 –º–∏–Ω—É—Ç (–¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–∞–∑ –≤ –¥–µ–Ω—å)

## üìä –ú–µ—Ç—Ä–∏–∫–∏

–ö–æ–º–∞–Ω–¥–∞ `/digest` ‚Üí –∫–Ω–æ–ø–∫–∞ "üìä –ú–µ—Ç—Ä–∏–∫–∏ API"

```
üìä –ú–µ—Ç—Ä–∏–∫–∏ API

üî¥ CoinGecko (–ø–æ—Å–ª–µ–¥–Ω—è—è –º–∏–Ω—É—Ç–∞): 2/30
üü° Fear & Greed (–ø–æ—Å–ª–µ–¥–Ω—è—è –º–∏–Ω—É—Ç–∞): 1

üìÅ –ó–∞–ø–∏—Å–µ–π –≤ –∫—ç—à–µ: 3

‚úÖ trending: 45s
‚úÖ global: 45s
‚úÖ fng: 45s
```

## üîÑ Graceful Degradation

–ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ API –º–æ–¥—É–ª—å:
1. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
2. –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–º–µ—Ç–∫—É `‚ö†Ô∏è –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏`
3. –õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É

–ü—Ä–∏–º–µ—Ä:
```
üåç –ö—Ä–∏–ø—Ç–æ-–¥–∞–π–¥–∂–µ—Å—Ç
‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏

üí∞ –ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è: $2.1T (+2.3%)
...
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
import asyncio

async def test():
    from market_digest import MarketDigest
    from pathlib import Path
    
    market = MarketDigest(Path("test_cache.json"))
    
    # –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤ ‚Äî –∑–∞–ø—Ä–æ—Å –∫ API
    results = await market.refresh_all()
    print(f"Refresh: {results}")
    
    # –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ ‚Äî –∏–∑ –∫—ç—à–∞ (–ë–ï–ó API –∑–∞–ø—Ä–æ—Å–æ–≤)
    text = market.get_digest()
    print(text)
    
    # –ú–µ—Ç—Ä–∏–∫–∏
    metrics = market.get_metrics()
    print(f"API calls: {metrics}")
    
    await market.close()

asyncio.run(test())
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—ç—à–∞

```json
{
  "trending": {
    "data": { ... },
    "fetched_at": 1708612345.678,
    "is_stale": false,
    "api_calls": 1
  },
  "global": { ... },
  "fng": { ... }
}
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ù–∏–∫–∞–∫–∏—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ** ‚Äî —Ç–æ–ª—å–∫–æ `get_digest()`
2. **–û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å ‚Üí –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** ‚Äî –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞
3. **–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî 5-60 –º–∏–Ω—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞
4. **Fallback –Ω–∞ —Ñ–∞–π–ª** ‚Äî –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å –ª–∏–º–∏—Ç–æ–≤
