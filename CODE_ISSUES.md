# –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–¥–µ

–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: 25.02.2026

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. news_digest.py - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ API
**–°—Ç—Ä–æ–∫–∞**: 312
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `data.get('results', {}).get('message')`, –Ω–æ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ NewsData.io API –æ—à–∏–±–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `data.get('message')`.

**–ë—ã–ª–æ:**
```python
logger.warning(f"NewsDigest: API error: {data.get('results', {}).get('message', 'Unknown error')}")
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```python
logger.warning(f"NewsDigest: API error: {data.get('message', 'Unknown error')}")
```

### 2. bot.py - Race condition –≤ _user_state
**–°—Ç—Ä–æ–∫–∞**: 73
**–ü—Ä–æ–±–ª–µ–º–∞**: –°–ª–æ–≤–∞—Ä—å `_user_state` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio.Lock` –∏–ª–∏ `TTLCache` –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `cachetools`.

### 3. bot.py - –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –≤ _user_state
**–ü—Ä–æ–±–ª–µ–º–∞**: –°–ª–æ–≤–∞—Ä—å `_user_state` —Ä–∞—Å—Ç—ë—Ç —Å –∫–∞–∂–¥—ã–º –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å TTL –¥–ª—è –∑–∞–ø–∏—Å–µ–π –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞.

## üü° –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 4. database.py - –ù–µ–ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≥–æ—Ä–æ–¥–∞
**–°—Ç—Ä–æ–∫–∞**: 121
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `dangerous_patterns` —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å–æ —Å—Ç—Ä–æ–∫–æ–π –¥–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å `city_lower` –≤–º–µ—Å—Ç–æ `city`.

### 5. bot.py - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
**–°—Ç—Ä–æ–∫–∞**: 511
**–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –≤—Ä–µ–º–µ–Ω–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û–±–µ—Ä–Ω—É—Ç—å –≤ try-except.

### 6. bot.py - –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
**–°—Ç—Ä–æ–∫–∞**: 772-774
**–ü—Ä–æ–±–ª–µ–º–∞**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–µ–ª–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å `get_data`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –≥–æ—Ä–æ–¥–∞–º.

### 7. news_digest.py - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π fallback
**–°—Ç—Ä–æ–∫–∞**: 381-388
**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ fallback –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–∞–∫–∂–µ –ø—É—Å—Ç–∞, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —ç—Ç–æ—Ç —Å–ª—É—á–∞–π.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø. –ø—Ä–æ–≤–µ—Ä–∫—É.

## üü¢ –ú–µ–ª–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 8. bot.py - –î–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î
**–°—Ç—Ä–æ–∫–∞**: 247-249
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω –º–µ—Ç–æ–¥ `get_user_settings()`.

### 9. bot.py - –ò–º–ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏
**–°—Ç—Ä–æ–∫–∞**: 650
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞.

### 10. news_digest.py - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ html
**–°—Ç—Ä–æ–∫–∏**: 543, 563, 577, 598
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω–∞—á–∞–ª–µ.

### 11-13. –ü—Ä–æ—á–∏–µ –º–µ–ª–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- api_client.py: –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏
- config.py: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SystemExit –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–∫–µ–Ω–∞
- bot.py: –¥–æ–±–∞–≤–∏—Ç—å /api –≤ —Å–ø—Ä–∞–≤–∫—É

## üìã –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö: 3
- –í–∞–∂–Ω—ã—Ö: 4
- –ú–µ–ª–∫–∏—Ö: 6

## ‚úÖ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (#1, #2, #3)
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (#4-#7)
3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –º–µ–ª–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (#8-#13)
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. –°–æ–∑–¥–∞—Ç—å PR –≤ main
